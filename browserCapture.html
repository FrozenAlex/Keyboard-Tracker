<head id="page-head">
    <style>
        :root {
            --fill-color: #badA55;
            --stroke-color: #000;
            --font-color: #000;
        }

        .pressed {
            fill: var(--fill-color) !important;
        }

        text {
            transform: scale(1.7);
        }

    </style>
</head>
<body id="keyboard-wrapper">
</body>
<script src="/socket.io/socket.io.js"></script>
<script>
    const server = io();
    server.on('keypress', (data) => {
        let { keycode } = data;
        console.log(keycode);
        let pressedKey = document.getElementById(keycode)
        if(pressedKey) {
            pressedKey.classList.add('pressed');
        }
    })
    server.on('keyrelease', (data) => {
        let { keycode } = data;
        console.log(keycode);
        let pressedKey = document.getElementById(keycode)
        if(pressedKey) {
            pressedKey.classList.remove('pressed');
        }
        
    })

    server.on('new-keyboard', (data) => {
        console.log(data)
        appendNewKeyboard(data);
    });
    let rootStyle = 
        `:root {
            --stroke-color: black;
            --fill-color: aqua;
            --font-color: black;
        }
        .pressed {
            fill: var(--fill-color);
        }
        svg>path {
            stroke: var(--stroke-color);
        }
        svg>circle {
            stroke: var(--stroke-color);
        }
        svg text {
            fill: var(--font-color);
        }`;
    let pageStyle; //Store for other css adaptations
    server.on('new-style', (data) => {
        pageStyle = rootStyle + data;
        console.log(data)
        addNewStyle(pageStyle);
    });

    server.on('settings', (data) => {
        applyNewSettings(data);
        for(setting in data) {
            localStorage.setItem(setting, data[setting]);
        }
    });
    
    function addNewStyle(data) {
        console.log(data)
        let styleContainer = document.getElementById('page-head');
        styleContainer.innerHTML = '<style>' +  data + '</style>';
    }
    function appendNewKeyboard(keyboard) {
        let container = document.getElementById('keyboard-wrapper');
        container.innerHTML = keyboard;
    }
    function applyNewSettings(data) {
        let {
            fontSize,
            selectedFont,
            strokeColor,
            fillColor,
            fontColor
        } = data;
        if((fontSize != localStorage.getItem('fontSize')) || (selectedFont != localStorage.getItem('selectedFont'))) {
            loadFont(fontSize, selectedFont);
        }
        if(strokeColor != localStorage.getItem('strokeColor')) {
            applyColor('stroke', strokeColor);
        }
        if(fillColor != localStorage.getItem('fillColor')) {
            applyColor('fill', fillColor);
        }
        if(fontColor != localStorage.getItem('fontColor')) {
            applyColor('font', fontColor);
        }
    }
    function loadFont(size, font) {
        let textNodes = document.querySelectorAll('text');
        let newFontSize = 0.8 * size;
        for(node of textNodes) {
            node.style.fontFamily = font;
            node.style.fontSize = size + 'em';
        }
    }
    function applyColor(type, color) {
        let root = document.documentElement;
        switch(type) {
            case 'stroke':
                root.style.setProperty('--stroke-color', color);
                break;
            case 'fill':
                root.style.setProperty('--fill-color', color);
                break;
            case 'font':
                root.style.setProperty('--font-color', color);
                break;
        }
    }
</script>